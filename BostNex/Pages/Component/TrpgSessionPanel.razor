@* ChatGPTとのやり取り1回分を表すコンポーネント *@
@* 
    データの大元は親が持ってないと何かと不便。
    データの元を子コンポーネントに持たせることはできるけど、後で親で集計する時などに結構不便だと思うのでやめておく。
*@
@using BostNex.Services
@using BostNexShared.Dto
@inject IOpenAiService _openAi
@inject ITrpgService _trpg
@inject ITrpgFormatService _format

@if (Session == null)
{
    <div class="spinner-border text-primary">
        <span class="visually-hidden">Loading...</span>
    </div>
    return;
}

<div class="@("row" + (Session.IsDisposed ? " bg-secondary" : ""))">
    @* Userの入力 *@
    <div class="d-flex flex-row justify-content-start mb-4 col-11">
        <img src="/Img/head_right.svg" alt="User" class="chat-icon">
        <div class="p-3 says mycomment mx-3">
            <p>@((MarkupString)Session.Text.Replace("\r\n", "<br />").Replace("\n", "<br />"))</p>
        </div>
    </div>
    @* AIからの返事 *@
    <div class="col-1" />
    <div class="d-flex flex-row justify-content-end mb-4 col-11">
        <div class="p-3 says aicomment mx-3">
            <p>@((MarkupString)Session.AiResponse.Replace("\r\n", "<br />").Replace("\n", "<br />"))</p>
        </div>
        <img src="/Img/head_left.svg" alt="Com" class="chat-icon">
    </div>
</div>

@code {
    //@bind-Session
    [Parameter]
    [EditorRequired]
    public TrpgSession Session { get; set; } = null!;
}
